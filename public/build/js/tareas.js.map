{"version":3,"sources":["tareas.js"],"names":["dashboardContainer","document","querySelector","modal","formulario","cerrarModal","e","elemento","target","classList","contains","add","remove","setTimeout","validarFormulario","preventDefault","tarea","value","trim","length","mostrarAlerta","async","url","location","origin","datosUrl","urlParams","URLSearchParams","search","Object","fromEntries","entries","obtenerDatosUrl","datos","FormData","append","id","btnSubmit","disabled","res","fetch","method","body","respuesta","json","tipo","mensaje","reset","err","agregarTarea","referencia","alertaAnterior","alerta","createElement","textContent","parentElement","insertBefore","nextElementSibling","addEventListener","innerHTML","appendChild"],"mappings":"CAAA,WACI,MAAMA,EAAqBC,SAASC,cAAc,cAClD,IAAIC,EACAC,EAqCJ,SAASC,EAAYC,GACjB,MAAMC,EAAWD,EAAEE,QACfD,EAASE,UAAUC,SAAS,iBAAmBH,EAASE,UAAUC,SAAS,YAC3EN,EAAWK,UAAUE,IAAI,WACzBP,EAAWK,UAAUG,OAAO,WAE5BC,WAAW,KACPV,EAAMS,UACP,MAIX,SAASE,EAAkBR,GAC3BA,EAAES,iBACF,MAAMC,EAAQf,SAASC,cAAc,UAAUe,MAAMC,OACjDF,EAAMG,OAAS,EACfC,EAAc,QAAS,sDAAuDnB,SAASC,cAAc,uBAMzGmB,eAA4BL,GACxB,MAAMM,EAASC,SAASC,OAAZ,oBACNC,EA6CV,WACI,MAAMC,EAAY,IAAIC,gBAAgBJ,SAASK,QAE/C,OADqBC,OAAOC,YAAYJ,EAAUK,WA/CjCC,GACXC,EAAQ,IAAIC,SAClBD,EAAME,OAAO,SAAUnB,GACvBiB,EAAME,OAAO,aAAcV,EAASW,IAEpC,MAAMC,EAAYjC,EAAWF,cAAc,uBAC3CmC,EAAUC,UAAW,EAErB,IACI,MAAMC,QAAYC,MAAMlB,EAAK,CACzBmB,OAAQ,OACRC,KAAKT,IAGHU,QAAkBJ,EAAIK,OAC5BxB,EAAeuB,EAAUE,KAAMF,EAAUG,QAAS7C,SAASC,cAAc,wBAErEyC,EAAUE,KAAO,aACjBzC,EAAW2C,QACXV,EAAUC,UAAW,GAErBD,EAAUC,UAAW,EAG3B,MAAOU,GACL5B,EAAc,QAAS,+BAA+BnB,SAASC,cAAc,uBAC7EmC,EAAUC,UAAW,GA/B7BW,CAAajC,GAmCb,SAASI,EAAcyB,EAAMC,EAASI,GAClC,MAAMC,EAAiBlD,SAASC,cAAc,WAC1CiD,GAAiBA,EAAevC,SAEpC,MAAMwC,EAASnD,SAASoD,cAAc,OACtCD,EAAO3C,UAAUE,IAAI,SAAUkC,GAC/BO,EAAOE,YAAcR,EAErBI,EAAWK,cAAcC,aAAaJ,EAAQF,EAAWO,oBAEzD5C,WAAW,KACPuC,EAAOxC,UACR,KAtGeX,SAASC,cAAc,kBAC/BwD,iBAAiB,SAE/B,WACIvD,EAAQF,SAASoD,cAAc,OAC/BlD,EAAMM,UAAUE,IAAI,SACpBR,EAAMwD,UAAY,usBAkBlB3D,EAAmB4D,YAAYzD,GAE/BC,EAAaH,SAASC,cAAc,eACpCW,WAAW,KACPT,EAAWK,UAAUG,OAAO,WAC5BR,EAAWK,UAAUE,IAAI,YAC1B,IAEHR,EAAMuD,iBAAiB,QAASrD,GAChCD,EAAWsD,iBAAiB,SAAU5C,MArC9C","file":"tareas.js","sourcesContent":["(function() {\r\n    const dashboardContainer = document.querySelector('.dashboard');\r\n    let modal;\r\n    let formulario;\r\n    const nuevaTareaBtn = document.querySelector('#agregar-tarea');\r\n    nuevaTareaBtn.addEventListener('click', mostrarFormulario);\r\n\r\n    function mostrarFormulario() {\r\n        modal = document.createElement('DIV');\r\n        modal.classList.add('modal');\r\n        modal.innerHTML = `\r\n            <form action=\"\" class=\"formulario cerrado nueva-tarea\">\r\n                <legend>Añade una nueva tarea</legend>\r\n                <div class=\"campo\">\r\n                    <label for=\"nombre\">Tarea</label>\r\n                    <input \r\n                    type=\"text\"\r\n                    name=\"tarea\"\r\n                    placeholder=\"Añadir Tarea\"\r\n                    id=\"tarea\"\r\n                    >\r\n                </div>\r\n                <div class=\"opciones\">\r\n                    <input type=\"submit\" class=\"submit-nueva-tarea\" value=\"Añadir Tarea\">\r\n                    <button type=\"button\" class=\"cerrar-modal\">Cancelar</button>\r\n                </div>\r\n            </form>\r\n        `;\r\n        dashboardContainer.appendChild(modal);\r\n        \r\n        formulario = document.querySelector('.formulario');\r\n        setTimeout(() => {\r\n            formulario.classList.remove('cerrado');\r\n            formulario.classList.add('abierto');\r\n        }, 10);\r\n\r\n        modal.addEventListener('click', cerrarModal);\r\n        formulario.addEventListener('submit', validarFormulario);\r\n    }\r\n\r\n    function cerrarModal(e) {\r\n        const elemento = e.target;\r\n        if( elemento.classList.contains('cerrar-modal') || elemento.classList.contains('modal')) {\r\n            formulario.classList.add('cerrado');\r\n            formulario.classList.remove('abierto');\r\n                \r\n            setTimeout(()=> {\r\n                modal.remove();\r\n            }, 450);\r\n            }\r\n    }\r\n\r\n    function validarFormulario(e) {\r\n    e.preventDefault();\r\n    const tarea = document.querySelector('#tarea').value.trim();\r\n    if( tarea.length < 5 ) {\r\n        mostrarAlerta('error', 'El nombre de la tarea debe ser mayor a 5 caracteres', document.querySelector('.formulario legend'));\r\n        return;\r\n    }\r\n    agregarTarea(tarea);\r\n    }\r\n\r\n    async function agregarTarea(tarea) {\r\n        const url = `${location.origin}/api/tareas/crear`;\r\n        const datosUrl = obtenerDatosUrl();\r\n        const datos = new FormData();\r\n        datos.append('nombre', tarea);\r\n        datos.append('proyectoId', datosUrl.id);\r\n\r\n        const btnSubmit = formulario.querySelector('.submit-nueva-tarea');\r\n        btnSubmit.disabled = true;\r\n\r\n        try {\r\n            const res = await fetch(url, {\r\n                method: 'POST',\r\n                body:datos\r\n            });\r\n\r\n            const respuesta = await res.json();\r\n            mostrarAlerta( respuesta.tipo, respuesta.mensaje, document.querySelector('.formulario legend') );\r\n\r\n            if( respuesta.tipo = 'correcto' ) {\r\n                formulario.reset();\r\n                btnSubmit.disabled = false;\r\n            } else {\r\n                btnSubmit.disabled = false;\r\n            }\r\n\r\n        } catch (err) {\r\n            mostrarAlerta('error', 'Hubo un error en el servidor',document.querySelector('.formulario legend'))\r\n            btnSubmit.disabled = false;\r\n        }\r\n    }\r\n\r\n    function mostrarAlerta(tipo, mensaje, referencia) {\r\n        const alertaAnterior = document.querySelector('.alerta');\r\n        if( alertaAnterior ) alertaAnterior.remove();\r\n\r\n        const alerta = document.createElement('DIV');\r\n        alerta.classList.add('alerta', tipo);\r\n        alerta.textContent = mensaje;\r\n\r\n        referencia.parentElement.insertBefore(alerta, referencia.nextElementSibling);\r\n\r\n        setTimeout(()=> {\r\n            alerta.remove()\r\n        }, 3000);\r\n    }\r\n\r\n    function obtenerDatosUrl() {\r\n        const urlParams = new URLSearchParams(location.search);\r\n        const objectParams = Object.fromEntries(urlParams.entries());\r\n        return objectParams;\r\n    }\r\n})();\r\n"]}