{"version":3,"sources":["tareas.js"],"names":["modal","formulario","tareas","dashboardContainer","document","querySelector","cerrarModal","e","elemento","target","classList","contains","add","remove","setTimeout","validarFormulario","preventDefault","tarea","value","trim","length","mostrarAlerta","async","url","location","origin","datosUrl","obtenerDatosUrl","datos","FormData","append","id","btnSubmit","disabled","res","fetch","method","body","respuesta","json","tipo","mensaje","reset","tareaObj","nombre","estado","proyectoId","mostrarTareas","err","agregarTarea","cambiarEstadoActual","nuevoEstado","$res","map","console","log","actualizarTarea","listaAnterior","estados","0","1","contenedorPagina","listaTareas","createElement","textoNoTareas","className","textContent","appendChild","forEach","contenedorTarea","dataset","tareaId","nombreTarea","opcionesDiv","btnEstadoTarea","toLowerCase","estadoTarea","ondblclick","btnEliminarTarea","idTarea","referencia","alertaAnterior","alerta","parentElement","insertBefore","nextElementSibling","urlParams","URLSearchParams","search","Object","fromEntries","entries","addEventListener","innerHTML","resultado","obtenerTareas"],"mappings":"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","file":"tareas.js","sourcesContent":["(function() {\r\n    let tareas = [];\r\n    let modal;\r\n    let formulario;\r\n    const dashboardContainer = document.querySelector('.dashboard');\r\n    const nuevaTareaBtn = document.querySelector('#agregar-tarea');\r\n    nuevaTareaBtn.addEventListener('click', mostrarFormulario);\r\n\r\n    obtenerTareas();\r\n\r\n    function mostrarFormulario() {\r\n        modal = document.createElement('DIV');\r\n        modal.classList.add('modal');\r\n        modal.innerHTML = `\r\n            <form action=\"\" class=\"formulario cerrado nueva-tarea\">\r\n                <legend>Añade una nueva tarea</legend>\r\n                <div class=\"campo\">\r\n                    <label for=\"nombre\">Tarea</label>\r\n                    <input \r\n                    type=\"text\"\r\n                    name=\"tarea\"\r\n                    placeholder=\"Añadir Tarea\"\r\n                    id=\"tarea\"\r\n                    >\r\n                </div>\r\n                <div class=\"opciones\">\r\n                    <input type=\"submit\" class=\"submit-nueva-tarea\" value=\"Añadir Tarea\">\r\n                    <button type=\"button\" class=\"cerrar-modal\">Cancelar</button>\r\n                </div>\r\n            </form>\r\n        `;\r\n        dashboardContainer.appendChild(modal);\r\n        \r\n        formulario = document.querySelector('.formulario');\r\n        setTimeout(() => {\r\n            formulario.classList.remove('cerrado');\r\n            formulario.classList.add('abierto');\r\n        }, 10);\r\n\r\n        modal.addEventListener('click', cerrarModal);\r\n        formulario.addEventListener('submit', validarFormulario);\r\n    }\r\n\r\n    function cerrarModal(e) {\r\n        const elemento = e.target;\r\n        if( elemento.classList.contains('cerrar-modal') || elemento.classList.contains('modal')) {\r\n            formulario.classList.add('cerrado');\r\n            formulario.classList.remove('abierto');\r\n                \r\n            setTimeout(()=> {\r\n                modal.remove();\r\n            }, 450);\r\n            }\r\n    }\r\n\r\n    function validarFormulario(e) {\r\n    e.preventDefault();\r\n    const tarea = document.querySelector('#tarea').value.trim();\r\n    if( tarea.length < 5 ) {\r\n        mostrarAlerta('error', 'El nombre de la tarea debe ser mayor a 5 caracteres', document.querySelector('.formulario legend'));\r\n        return;\r\n    }\r\n    agregarTarea(tarea);\r\n    }\r\n\r\n    async function agregarTarea(tarea) {\r\n        const url = `${location.origin}/api/tareas/crear`;\r\n        const datosUrl = obtenerDatosUrl();\r\n        const datos = new FormData();\r\n        datos.append('nombre', tarea);\r\n        datos.append('proyectoId', datosUrl.id);\r\n\r\n        const btnSubmit = formulario.querySelector('.submit-nueva-tarea');\r\n        btnSubmit.disabled = true;\r\n\r\n        try {\r\n            const res = await fetch(url, {\r\n                method: 'POST',\r\n                body:datos\r\n            });\r\n\r\n            const respuesta = await res.json();\r\n            mostrarAlerta( respuesta.tipo, respuesta.mensaje, document.querySelector('.formulario legend') );\r\n\r\n            if( respuesta.tipo = 'correcto' ) {\r\n                formulario.reset();\r\n                btnSubmit.disabled = false;\r\n\r\n                const tareaObj = {\r\n                    id: respuesta.id,\r\n                    nombre: tarea,\r\n                    estado: \"0\",\r\n                    proyectoId: respuesta.proyectoId\r\n                }\r\n\r\n                tareas = [...tareas, tareaObj];\r\n                mostrarTareas();\r\n            } else {\r\n                btnSubmit.disabled = false;\r\n            }\r\n\r\n        } catch (err) {\r\n            mostrarAlerta('error', 'Hubo un error en el servidor',document.querySelector('.formulario legend'))\r\n            btnSubmit.disabled = false;\r\n        }\r\n    }\r\n\r\n    function cambiarEstadoActual(tarea) {\r\n        const nuevoEstado =  tarea.estado === \"1\" ? \"0\" : \"1\";\r\n        tarea.estado = nuevoEstado;\r\n        $res = actualizarTarea(tarea);\r\n        \r\n    }\r\n\r\n    async function actualizarTarea(tarea) {\r\n        const {estado, id, nombre} = tarea;\r\n        const datos = new FormData();\r\n        datos.append('id', id);\r\n        datos.append('nombre', nombre);\r\n        datos.append('estado', estado);\r\n        datos.append('proyectoId', obtenerDatosUrl().id);\r\n\r\n        try {\r\n            const url = `${location.origin}/api/tareas/actualizar`;\r\n\r\n            const res = await fetch(url, {\r\n                method: 'POST',\r\n                body: datos\r\n            });\r\n\r\n            const resultado = await res.json();\r\n\r\n            if( resultado.tipo === \"correcto\") {\r\n                tareas = tareas.map( tarea => {\r\n                    if ( tarea.id === id ) {\r\n                        tarea.estado = estado\r\n                    }\r\n                    return tarea;\r\n                })\r\n\r\n                mostrarTareas();\r\n            }\r\n\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n    }\r\n\r\n    async function obtenerTareas() {\r\n        const datosUrl = obtenerDatosUrl();\r\n        const url = `${location.origin}/api/tareas?id=${datosUrl.id}`;\r\n\r\n        try {\r\n            const res = await fetch(url);\r\n            const resultado = await res.json();\r\n            tareas = resultado.tareas;\r\n\r\n            mostrarTareas();\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n    }\r\n\r\n    function mostrarTareas() {\r\n        const listaAnterior = document.querySelector('#listado-tareas');\r\n        if( listaAnterior ) listaAnterior.remove();\r\n\r\n        const estados = {\r\n            0: 'Pendiente',\r\n            1: 'Completado'\r\n        };\r\n        const contenedorPagina = document.querySelector('.contenedor-sm');\r\n        const listaTareas = document.createElement('UL');\r\n        listaTareas.classList.add('listado-tareas');\r\n        listaTareas.id = 'listado-tareas';\r\n\r\n        \r\n        if( tareas.length === 0 ) {\r\n            const textoNoTareas = document.createElement('LI');\r\n            textoNoTareas.className = 'no-tareas';\r\n            textoNoTareas.textContent = 'No Hay tareas';\r\n\r\n            listaTareas.appendChild(textoNoTareas);\r\n            contenedorPagina.appendChild(listaTareas);\r\n            return;\r\n        }\r\n\r\n        tareas.forEach( tarea => {\r\n            const {id, nombre, estado} = tarea;\r\n            const contenedorTarea = document.createElement('LI');\r\n            contenedorTarea.classList.add('tarea');\r\n            contenedorTarea.dataset.tareaId = id;\r\n\r\n            const nombreTarea = document.createElement('P');\r\n            nombreTarea.textContent = nombre;\r\n\r\n            const opcionesDiv = document.createElement('DIV');\r\n            opcionesDiv.classList.add('opciones');\r\n\r\n            const btnEstadoTarea = document.createElement('BUTTON');\r\n            btnEstadoTarea.classList.add('estado-tarea');\r\n            btnEstadoTarea.classList.add(estados[estado].toLowerCase());\r\n            btnEstadoTarea.dataset.estadoTarea = estado;\r\n            btnEstadoTarea.textContent = estados[estado];\r\n            btnEstadoTarea.ondblclick = ()=> {\r\n                cambiarEstadoActual({...tarea})\r\n            }\r\n\r\n            const btnEliminarTarea = document.createElement('BUTTON');\r\n            btnEliminarTarea.classList.add('eliminar-tarea');\r\n            btnEliminarTarea.dataset.idTarea = id;\r\n            btnEliminarTarea.textContent = 'Eliminar Tarea';\r\n\r\n            opcionesDiv.append( btnEstadoTarea, btnEliminarTarea );\r\n            contenedorTarea.append( nombreTarea, opcionesDiv );\r\n\r\n            listaTareas.appendChild(contenedorTarea);\r\n        })\r\n\r\n        contenedorPagina.appendChild(listaTareas);\r\n    }\r\n\r\n    function mostrarAlerta(tipo, mensaje, referencia) {\r\n        const alertaAnterior = document.querySelector('.alerta');\r\n        if( alertaAnterior ) alertaAnterior.remove();\r\n\r\n        const alerta = document.createElement('DIV');\r\n        alerta.classList.add('alerta', tipo);\r\n        alerta.textContent = mensaje;\r\n\r\n        referencia.parentElement.insertBefore(alerta, referencia.nextElementSibling);\r\n\r\n        setTimeout(()=> {\r\n            alerta.remove()\r\n        }, 3000);\r\n    }\r\n\r\n    function obtenerDatosUrl() {\r\n        const urlParams = new URLSearchParams(location.search);\r\n        const objectParams = Object.fromEntries(urlParams.entries());\r\n        return objectParams;\r\n    }\r\n})();\r\n"]}